---
title: "OSSã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã—ãŸ(vue-i18n)"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Vue.js, JavaScript, vue-i18n]
published: true
---

# æ¦‚è¦

Vue.jsã®å¤šè¨€èªåŒ–ã®ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹vue-i18nã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’ã—ã¾ã—ãŸã€‚
OSSã¸ã®ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’è‡ªåˆ†è‡ªèº«ã‚„ã£ãŸã“ã¨ãŒãªã‹ã£ãŸã®ã§ã€å‚™å¿˜éŒ²ã‚‚å…¼ã­ã¦è¨˜è¼‰ã—ã¾ã™ã€‚
OSSã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’ã‚„ã£ã¦ã¿ã‚ˆã†ã¨æ€ã£ã¦ã„ã‚‹æ–¹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚


## å¯¾è±¡ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
[vue-i18n](https://github.com/kazupon/vue-i18n)

> Internationalization plugin for Vue.js

## issueã®å†…å®¹
https://github.com/kazupon/vue-i18n/issues/1502

> $d doesn't support key format object as mentionned in the docs. 

# ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã¾ã§ã®å®Ÿæ–½å†…å®¹

## å•é¡Œå†…å®¹ã¨æœŸå¾…å‹•ä½œã‚’æŠŠæ¡ã™ã‚‹

ã¾ãšã€å•é¡Œã®å†…å®¹ã¨æœŸå¾…å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚
issueã‚’è¦‹ã‚‹ã¨ã€

> Following the doc I expect to be able to use a `Intl.DateTimeFormat` inside the `$d` function the same way I do with `$n`. But $d only accept string key and object format isn't supported.
> For exemple : `$d(new Date(), { year: 'numeric' })` But it doesn't work and I have to define all the formats in the config first.

ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚
$dã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦keyã ã‘ã§ã¯ãªãobjectã‚‚å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã™ã¹ãã¨ã„ã†å†…å®¹ã®ã‚ˆã†ã§ã™ã€‚


## é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹

å•é¡Œã®å†…å®¹ãŒæŠŠæ¡ã§ããŸã®ã§ã€æ¬¡ã«é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
READMEã‚’ç¢ºèªã™ã‚‹ã¨ã€

> ğŸ’ª Contribution
> Please make sure to read the [Contributing Guide](https://github.com/kazupon/vue-i18n/blob/dev/CONTRIBUTING.md) before making a pull request.

ã¨ã‚ã‚Šã¾ã™ã®ã§ã€ã¾ãšã¯[Contributing Guide](https://github.com/kazupon/vue-i18n/blob/dev/CONTRIBUTING.md)ã®å†…å®¹ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

[Development Setup](https://github.com/kazupon/vue-i18n/blob/dev/CONTRIBUTING.md#development-setup)ã«ã€é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰æ‰‹é †ãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã™ã®ã§ã“ã‚Œã«æ²¿ã£ã¦é€²ã‚ã¾ã™ã€‚


### 1. é–‹ç™ºç”¨ã«ãƒ“ãƒ«ãƒ‰ã™ã‚‹
```bash
npm run dev
ãƒ»ãƒ»ãƒ»
Error: Cannot find module 'webpack-cli/bin/config-yargs'
```

æ—©é€Ÿã®ã‚¨ãƒ©ãƒ¼ã€‚
èª¿ã¹ã¦ã¿ã‚‹ã¨ã€`webpack-dev-serve`ã§ã¯ãªãã€`webpack serve`ã‚’ä½¿ãˆã°è‰¯ã•ãã†ãªã®ã§package.jsonã‚’æ›¸ãæ›ãˆã¾ã™ã€‚
https://github.com/webpack/webpack.js.org/pull/4091/files

```diff:package.json
- "dev": "cross-env BABEL_ENV=test webpack-dev-server --inline --hot --open --content-base ./test/unit/ --config config/webpack.dev.conf.js",
+ "dev": "cross-env BABEL_ENV=test webpack serve --inline --hot --open --content-base ./test/unit/ --config config/webpack.dev.conf.js",
```
ä¿®æ­£ã—ãŸã¨ã“ã‚ã€ç„¡äº‹ã«unit testãŒå®Œäº†ã—ã¾ã—ãŸã€‚

![unit test](https://storage.googleapis.com/zenn-user-upload/6f7ff1a7e34c-20221103.png)


### 2. lintã‚’å®Ÿè¡Œã™ã‚‹
```bash
npm run lint
```
warningã¯å‡ºã‚‹ã‚ˆã†ã§ã™ãŒã¨ã‚Šã‚ãˆãšOKã€‚


### 3. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹
```bash
npm run test:unit
ãƒ»ãƒ»ãƒ»
Safari 16.0 (Mac OS 10.15.7): Executed 109 of 312 (2 FAILED) (0 secs / 0.443 secs)
Safari 16.0 (Mac OS 10.15.7): Executed 312 of 312 (3 FAILED) (3.213 secs / 2.661 secs)
TOTAL: 5 FAILED, 1044 SUCCESS
```
Safariã§FAILEDã¨ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

çµæœã‚’è©³ã—ãè¦‹ã‚‹ã¨ã€
```bash
Safari 16.0 (Mac OS 10.15.7) basic i18n#n locale argument with second argument should be formatted FAILED
          # test/unit/basic.test.js:799
          
          assert.strictEqual(i18n.n(money, 'currency', 'ja-JP'), 'ï¿¥10,100')
                             |    | |                                       
                             |    | 10100                                   
                             |    "Â¥10,100"                                 
                             VueI18n{_vm:#Vue#,_formatter:#BaseFormatter#,_modifiers:#Object#,_root:null,_sync:true,_fallbackRoot:true,_fallbackRootWi
```
ã¨ãªã£ã¦ãŠã‚Šã€`$n`ã§ã®ã‚¨ãƒ©ãƒ¼ã§ã—ãŸã€‚
ä»Šå›ä¿®æ­£ã‚’ã—ãŸã„`$d`ã«ã¯é–¢ä¿‚ãŒãªã•ãã†ãªã®ã¨ã€è§£æ±ºç­–ãŒã™ãã«ã¯ã‚ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ä¸€æ—¦å…ˆã«é€²ã‚“ã§ã¿ã¾ã™ã€‚
                            

### 4. ãƒ“ãƒ«ãƒ‰ã™ã‚‹
```bash
npm run build
```
å•é¡Œãªãå®Œäº†ã€‚


### 5. ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹
```bash
npm run test
ãƒ»ãƒ»ãƒ»
OK. 66  total assertions passed (37.324s)
```
ãƒ†ã‚¹ãƒˆOKã§ã™ã€‚
`npm run test:unit`ã§ã®ä¸€éƒ¨å•é¡Œã¯ã‚ã£ãŸã‚‚ã®ã®ä¸€æ—¦ã¯ã“ã‚Œã§é€²ã‚ã‚‰ã‚Œãã†ã§ã™ã€‚


### 6. exmampleã‚’ç¢ºèªã™ã‚‹
exampleã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã£ãŸã®ã§ã“ã‚Œã®ä¸­ã‚’ã¿ã‚‹ã¨[datetime/index.html](https://github.com/kazupon/vue-i18n/blob/dev/examples/datetime/index.html)ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦è¦‹ã¦ã¿ã‚‹ã¨`$d`ã®å®Ÿè¡ŒçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ã¦é–‹ç™ºã‚’é€²ã‚ã¦ã„ã‘ã°è‰¯ã•ãã†ã§ã™ã€‚
![$dã®example](https://storage.googleapis.com/zenn-user-upload/eed684e0d846-20221103.png)


ã“ã‚Œã§é–‹ç™ºã§ãã‚‹ç’°å¢ƒã¯æ•´ã„ã¾ã—ãŸã€‚


## ä¿®æ­£æ–¹é‡ã‚’æ±ºã‚ã‚‹
é–‹ç™ºç’°å¢ƒãŒæ•´ã„ã¾ã—ãŸã®ã§ã©ã®ã‚ˆã†ã«ä¿®æ­£ã‚’ã—ã¦ãã‹è€ƒãˆã¾ã™ã€‚
ã‚ã‚‰ãŸã‚ã¦issueã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã¨ã€

> Following the doc I expect to be able to use a Intl.DateTimeFormat inside the $d function the same way I do with $n

ã¨ã®è¨˜è¼‰ãŒã‚ã‚Šã€`$n`ã«ã¯ã‚ã‚‹æ©Ÿèƒ½ãŒ`$d`ã«ã¯ãªã„ã¨è¨€ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

[index.js](https://github.com/kazupon/vue-i18n/blob/dev/src/index.js)ã®`$n`ã‚’è¦‹ã¦ã¿ã¾ã™ã¨ã€

```js:index.js
n (value: number, ...args: any): NumberFormatResult {
  ãƒ»ãƒ»ãƒ»
  if (args.length === 1) {
    ãƒ»ãƒ»ãƒ»
    } else if (isObject(args[0])) {
      ãƒ»ãƒ»ãƒ»
      // Filter out number format options only
      options = Object.keys(args[0]).reduce((acc, key) => {
        if (includes(numberFormatKeys, key)) {
          return Object.assign({}, acc, { [key]: args[0][key] })
        }
        return acc
      }, null)
    }
  }
  ãƒ»ãƒ»ãƒ»
  return this._n(value, locale, key, options)
}
```

ã¨ãªã£ã¦ãŠã‚Šã€`$n`ã®2ã¤ç›®ã®å¼•æ•°ãŒObjectã ã£ãŸå ´åˆã«optionsã«å¤‰æ›ã™ã‚‹å‡¦ç†ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®å‡¦ç†ãŒ`$d`ã«ã¯ãªã„ã‚ˆã†ãªã®ã§ã€åŒã˜ã‚ˆã†ãªå‡¦ç†ã‚’`$d`ã«æ›¸ã„ã¦ã„ã‘ã°è‰¯ã•ãã†ã§ã™ã€‚

## ä¿®æ­£ã™ã‚‹

ã‚ã¨ã¯`$d`ã¨`$n`ã‚’è¦‹æ¯”ã¹ã¦ã€optionsã«é–¢ã™ã‚‹å‡¦ç†ã‚’`$d`ã«è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

ä¿®æ­£ãŒä¸€é€šã‚Šå®Œäº†ã—ãŸã‚ã¨ã«å‹•ä½œãƒã‚§ãƒƒã‚¯ã®ãŸã‚ã«ã€[datetime/index.html](https://github.com/kazupon/vue-i18n/blob/dev/examples/datetime/index.html)ã«`$d`ã®å¼•æ•°ã«objectã‚’æ¸¡ã—ã¦ã¿ã¾ã™ã¨ã€

```diff:datetime/index.html
<p>{{ $t('current_datetime')}}: {{ $d(now, 'long') }}</p>
+ <p>{{ "å¹´(2æ¡)" }}: {{ $d(now, {year: '2-digit'}) }}</p>
```

ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã€ç„¡äº‹å‹•ãã¾ã—ãŸã€‚
![å‹•ä½œç¢ºèªçµæœ](https://storage.googleapis.com/zenn-user-upload/bb95137ad162-20221103.png)


## ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã

æœ€å¾Œã«ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

### 1. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®è¿½åŠ 
testãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèªã™ã‚‹ã¨ã€e2eã®ä¸­ã«[number.js](https://github.com/kazupon/vue-i18n/blob/dev/test/e2e/test/number.js)ã¯ã‚ã‚Šã¾ã™ãŒã€datetime.jsãŒã‚ã‚Šã¾ã›ã‚“ã€‚
number.jsã‚’å‚è€ƒã«datetime.jsã‚’è¿½åŠ ã™ã‚‹ã®ãŒè‰¯ã•ãã†ã§ã™ã€‚

### 2. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä½œæˆ
`/test/e2e/test/number.js`ã‚’è¦‹ã‚‹ã¨examplesã®ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã®ã§ã€`/examples/number/datetime/index.html`ã‚‚ä¿®æ­£ã—ã¦ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã®ãŒè‰¯ã•ãã†ã§ã™ã€‚
```js:number.js
module.exports = {
  number: function (browser) {
    browser
      .url('http://localhost:8080/examples/number/')
      .waitForElementVisible('#app', 1000)
      .assert.containsText('p', 'ãŠé‡‘: ï¿¥1,000')
      .click('select option[value=en-US]')
      .assert.containsText('p', 'Money: $1,000')
      .end()
  }
}
```

### 3. ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å›ºå®š
ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ç„¡äº‹ã«å‹•ãã¾ã—ãŸãŒã€æ—¥æ™‚ã®ãƒ†ã‚¹ãƒˆã§ã™ã®ã§å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚‰ãšãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯å›ºå®šã—ãŸã„ã§ã™ã€‚

e2eã«ã¯Nightwatch.jsã‚’ä½¿ã£ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã€[Nightwatch.jsã®ã‚µã‚¤ãƒˆ](https://nightwatchjs.org/guide/quickstarts/create-and-run-a-test-with-cloud-providers.html)ã‚’è¦‹ã¦ã¿ã¾ã™ã¨
```json:nightwatch.json
module.exports = {
    ...,
    test_settings: {
        ...,
        saucelabs: {
            desiredCapabilities: {
                ...,
                timeZone: 'London'

```
ã¨ã‚ã‚‹ã®ã§ã€ã“ã®è¨­å®šã§ã§ããã†ã§ã™ã€‚

ã¨æ€ã£ã¦ã‚„ã£ã¦ã¿ã¾ã—ãŸãŒã€ã€ã€timeZoneãŒè¨­å®šã•ã‚Œãšã€ä»–ã®æ–¹æ³•ã‚’è€ƒãˆã¾ã™ã€‚

ãã“ã§ã€æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆã§ã‚‚ä½•ã‚‰ã‹ã®æ–¹æ³•ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯å›ºå®šã—ã¦ã‚‹ã¯ãšã ã¨æ€ã„ã€ä»–ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã‚‹ã¨[/test/unit/fixture/datetime.js](https://github.com/kazupon/vue-i18n/blob/dev/test/unit/fixture/datetime.js)ã«ã‚ã‚Šã¾ã—ãŸï¼


```js
if (isChrome) {
  formats['en-US']['short']['timeZone'] = 'America/New_York'
  formats['ja-JP']['short']['timeZone'] = 'Asia/Tokyo'
  formats['ja-JP']['long']['timeZone'] = 'Asia/Tokyo'
```
`$d`ã®æ©Ÿèƒ½è‡ªä½“ã«`timeZone`ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€ã“ã‚Œã§è¨­å®šã§ãã‚‹ã‚ˆã†ã§ã™ã€‚

ã“ã‚Œã§exampleã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã™ã‚Œã°è‰¯ã•ãã†ã§ã™ã€‚

```diff:index.html
      var dateTimeFormats = {
        'en-US': {
          long: {
            year: 'numeric', month: '2-digit', day: '2-digit',
            hour: '2-digit', minute: '2-digit', second: '2-digit',
+            timeZone: 'America/Los_Angeles'
          }
        },
        'ja-JP': {
          long: {
            year: 'numeric', month: '2-digit', day: '2-digit',
            hour: '2-digit', minute: '2-digit', second: '2-digit',
            hour12: true,
+            timeZone: 'Asia/Tokyo'
          }
        }
      }
```

## PRã‚’å‡ºã™

ã“ã‚Œã§ä¿®æ­£ãŒä¸€é€šã‚Šçµ‚ã‚ã£ãŸã®ã§ã€[Pull Request Guidelines](https://github.com/kazupon/vue-i18n/blob/dev/CONTRIBUTING.md#pull-request-guidelines)ã‚’è¦‹ã¦ã€æ›¸ã„ã¦ã‚ã‚‹ã¨ãŠã‚Šã«PRã‚’å‡ºã—ã¾ã™ã€‚

PRã®ã‚³ãƒ¡ãƒ³ãƒˆã¯ç‰¹ã«æŒ‡å®šã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒãªã‹ã£ãŸã®ã§ã€ä¿®æ­£æ–¹é‡ã‚„ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’è²¼ã£ã¦ã‚ã‹ã‚Šã‚„ã™ãã—ã¦ãŠãã¾ã—ãŸã€‚
https://github.com/kazupon/vue-i18n/pull/1569


ç¿Œæ—¥ã«ã¯ã™ãã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã„ãŸã ã„ã¦ç„¡äº‹ãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸï¼