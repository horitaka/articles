---
title: "Pythonã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã®æ§‹ç¯‰(pytest)"
emoji: "ğŸ› "
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Python, test]
published: true
---

# æ¦‚è¦

- Pythonã«pytestã‚’å°å…¥ã™ã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™
- pytestã®ã¿ã§ã¯ã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨ˆæ¸¬ã‚„watchãƒ¢ãƒ¼ãƒ‰ã§ã®å®Ÿè¡ŒãŒã§ããªã„ãŸã‚ã€ãã‚Œã‚‰ã®å°å…¥æ‰‹é †ã‚‚ã‚ã‚ã›ã¦èª¬æ˜ã—ã¾ã™

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±**
- Python: 3.10.7
- pytest: 7.1.3
- pytest-cov: 4.0.0
- pytest-watch: 4.2.0

**å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å…¬å¼ã‚µã‚¤ãƒˆ**
- [pytest](https://docs.pytest.org/en/7.1.x/index.html)
- [pytest-cov](https://pytest-cov.readthedocs.io/en/latest/index.html)
- [pytest-watch](https://github.com/joeyespo/pytest-watch)

**ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰**
ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯[ã“ã¡ã‚‰](https://github.com/horitaka/pytest-sample)ã§ã™ã€‚


# å°å…¥æ‰‹é †

## pytestã®å°å…¥

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
$ pip install pytest
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚
```py:sample.py
def add(x, y):
    return x + y
```

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚
```py:test_sample.py
def test_add():
    assert add(1, 2) == 3
```

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™
```bash
$ pytest test_sample.py                          
```

### ä¾‹å¤–ã®ãƒ†ã‚¹ãƒˆ
ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã‚‹ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆã¯pytest.raisesã‚’ä½¿ç”¨ã—ã¾ã™
```py:sample.py
def raise_zero_division_error():
    return 1 / 0
```
```py:test_sample.py
def test_raise_zero_division_error():
    with pytest.raises(ZeroDivisionError):
        raise_zero_division_error()
```

### parameterizeã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ
å…¥åŠ›å€¤ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆã¯pytest.parameterizeã‚’ä½¿ç”¨ã—ã¾ã™
```py:test_sample.py
def test_add():
    assert add(1, 2) == 3
```
```py:test_sample.py
@pytest.mark.parametrize(
    "input,expected", 
    [({"x": 1, "y": 2}, 3), ({"x": 10, "y": 5}, 15)]
)
def test_add(input, expected):
    assert add(input["x"], input["y"]) == expected
```


## ã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨ˆæ¸¬

pytestã®ã¿ã§ã¯ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¨ˆæ¸¬ã§ããªã„ãŸã‚ã€åˆ¥é€”pytest-covã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**pytest-covã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
$ pip install pytest-cov
```

pytestã®å®Ÿè¡Œæ™‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«--covã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å‘½ä»¤ç¶²ç¾…(C0)ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¨ˆæ¸¬ã§ãã™ã€‚
```bash
$ pytest --cov=sample

---------- coverage: platform darwin, python 3.7.8-final-0 -----------
Name        Stmts   Miss  Cover
-------------------------------
sample.py       9      0   100%
-------------------------------
TOTAL           9      0   100%

```

æ¡ä»¶ç¶²ç¾…(C1)ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¨ˆæ¸¬ã™ã‚‹å ´åˆã¯--cov-branchã‚’è¿½åŠ ã—ã¾ã™ã€‚
```bash
$ pytest --cov=sample --cov-branch test_sample.py

test_sample.py .....                                            [100%]

---------- coverage: platform darwin, python 3.7.8-final-0 -----------
Name        Stmts   Miss Branch BrPart  Cover
---------------------------------------------
sample.py       9      0      2      0   100%
---------------------------------------------
TOTAL           9      0      2      0   100%

```


## watchãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ†ã‚¹ãƒˆ
ã“ã“ã¾ã§ã§pytestã®å°å…¥æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã—ãŸã€‚
ãŸã ã—ã“ã®ã¾ã¾ã§ã¯ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹ãŸã³ã«æ¯å›pytestã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
pytest-watchã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€pytestã‚’watchãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã—ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦è‡ªå‹•ã§å†ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

**pytest-watchã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
$ pip install pytest-watch
```

**watchãƒ¢ãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œ**
```bash
$ pytest-watch # or ptw
```
ã“ã‚Œã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹ãŸã³ã«è‡ªå‹•ã§å†ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚


pytestã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦watchãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã—ãŸã„å ´åˆã¯pytest-watchã‚’runnerã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãã§å®Ÿè¡Œã—ã¾ã™
```bash
$ pytest-watch --runner "python -m pytest --cov=sample test_sample.py"
```


